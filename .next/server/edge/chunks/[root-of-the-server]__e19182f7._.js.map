{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/axiosClient.ts"],"sourcesContent":["import axios, { AxiosError } from 'axios';\n\nconst baseURL =\n    process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3047/api/v1';\n\n// Create an Axios instance\nconst axiosClient = axios.create({\n    baseURL: baseURL,\n    withCredentials: true, // send cookies with every request\n    headers: {\n        'Content-Type': 'application/json',\n    },\n    timeout: 10000, // optional: 10 second timeout\n});\n\n// Optional: Add global error handling\naxiosClient.interceptors.response.use(\n    (response) => response,\n    (error) => {\n        //     console.log('\\n\\n\\n\\n');\n        //     console.log(\n        //         '=================Axiox Client Error DATA================='\n        //     );\n        //     console.log(error.response.data);\n        //     console.log('\\n\\n\\n\\n');\n\n        //     console.log('API Error:');\n        //     console.log(\n        //         util.inspect(\n        //             {\n        //                 message: error.message,\n        //                 url: error.config?.url,\n        //                 status: error.response?.status,\n        //                 errorData: error.response?.data,\n        //             },\n        //             { depth: null, colors: true }\n        //         )\n        //     );\n\n        // Optionally shape the error to a standard format\n        const customError = {\n            message: error.response?.data?.message || 'Something went wrong',\n            status: error.response?.status || 500,\n            originalError: error,\n            errorData: error.response?.data,\n        };\n\n        // throw customError;\n        // toast.error(customError.message);\n\n        return Promise.reject(customError); // reject with customError\n    }\n);\n\nexport class CustomAxiosError extends AxiosError {\n    // message: string;\n    // status: number;\n    originalError: any;\n    errorData?: any;\n}\n\nexport default axiosClient;\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,MAAM,UACF,oEAAmC;AAEvC,2BAA2B;AAC3B,MAAM,cAAc,gMAAA,CAAA,UAAK,CAAC,MAAM,CAAC;IAC7B,SAAS;IACT,iBAAiB;IACjB,SAAS;QACL,gBAAgB;IACpB;IACA,SAAS;AACb;AAEA,sCAAsC;AACtC,YAAY,YAAY,CAAC,QAAQ,CAAC,GAAG,CACjC,CAAC,WAAa,UACd,CAAC;IACG,+BAA+B;IAC/B,mBAAmB;IACnB,sEAAsE;IACtE,SAAS;IACT,wCAAwC;IACxC,+BAA+B;IAE/B,iCAAiC;IACjC,mBAAmB;IACnB,wBAAwB;IACxB,gBAAgB;IAChB,0CAA0C;IAC1C,0CAA0C;IAC1C,kDAAkD;IAClD,mDAAmD;IACnD,iBAAiB;IACjB,4CAA4C;IAC5C,YAAY;IACZ,SAAS;IAET,kDAAkD;IAClD,MAAM,cAAc;QAChB,SAAS,MAAM,QAAQ,EAAE,MAAM,WAAW;QAC1C,QAAQ,MAAM,QAAQ,EAAE,UAAU;QAClC,eAAe;QACf,WAAW,MAAM,QAAQ,EAAE;IAC/B;IAEA,qBAAqB;IACrB,oCAAoC;IAEpC,OAAO,QAAQ,MAAM,CAAC,cAAc,0BAA0B;AAClE;AAGG,MAAM,yBAAyB,yMAAA,CAAA,aAAU;IAC5C,mBAAmB;IACnB,kBAAkB;IAClB,cAAmB;IACnB,UAAgB;AACpB;uCAEe"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/services/authService.ts"],"sourcesContent":["'use server';\n\nimport axiosClient from '../../axiosClient';\n\n/**\n * login with google\n */\nexport const authGoogleLogin = async (input: {\n    email: string;\n    name: string;\n    authProvider: string;\n    googleId: string;\n    emailVerified: boolean;\n}) => {\n    try {\n        const res = await axiosClient.post('/auth/google-login', input);\n        return res.data.data;\n    } catch (error: any) {\n        const errorData = error?.errorData;\n        throw errorData.error.messages[0];\n    }\n}; // end\n"],"names":[],"mappings":";;;AAEA;AAFA;;AAOO,MAAM,kBAAkB,OAAO;IAOlC,IAAI;QACA,MAAM,MAAM,MAAM,0HAAA,CAAA,UAAW,CAAC,IAAI,CAAC,sBAAsB;QACzD,OAAO,IAAI,IAAI,CAAC,IAAI;IACxB,EAAE,OAAO,OAAY;QACjB,MAAM,YAAY,OAAO;QACzB,MAAM,UAAU,KAAK,CAAC,QAAQ,CAAC,EAAE;IACrC;AACJ,GAAG,MAAM"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/auth.config.ts"],"sourcesContent":["import type { NextAuthConfig, Session, User } from 'next-auth';\nimport { authGoogleLogin } from './lib/services/authService';\nimport axiosClient from './axiosClient';\n\nasync function authenticate(email: string, password: string) {\n    try {\n        const res = await axiosClient.post('/users/login', { email, password });\n        return res.data;\n    } catch (error: any) {\n        // console.log('\\n\\n\\nauthenticate error:', error);\n        if ('errorData' in error) {\n            console.log('\\n\\n\\nauthenticate error:', error.errorData);\n\n            // Try different error message paths\n            let message = 'Failed to authenticate user.';\n\n            if (error.errorData?.error?.messages?.[0]) {\n                message = error.errorData.error.messages[0];\n            } else if (error.errorData?.messages?.[0]) {\n                message = error.errorData.messages[0];\n            } else if (error.errorData?.message) {\n                message = error.errorData.message;\n            } else if (error.message) {\n                message = error.message;\n            }\n\n            throw new Error(message);\n        }\n        throw new Error('Failed to authenticate user.');\n    }\n}\n\nexport const authConfig = {\n    session: {\n        strategy: 'jwt',\n        maxAge: 30 * 24 * 60 * 60, // 30 days\n    },\n    pages: {\n        signIn: '/login',\n    },\n    callbacks: {\n        async signIn({ user, account, profile, email, credentials }) {\n            console.log('\\n\\n\\nuser from signIn: ', user);\n            console.log('\\n\\n\\naccount from signIn: ', account);\n            console.log('\\n\\n\\nprofile from signIn: ', profile);\n            console.log('\\n\\n\\nemail from signIn: ', email);\n            console.log('\\n\\n\\ncredentials from signIn: ', credentials);\n\n            if (account?.provider === 'google') {\n                const input = {\n                    email: user.email as string,\n                    name: user.name as string,\n                    authProvider: 'google',\n                    googleId: profile?.sub as string,\n                    emailVerified: true,\n                };\n\n                const userRes = await authGoogleLogin(input);\n\n                if (userRes?.length > 0 && userRes[0].token) {\n                    console.log('\\n\\n\\nuserRes from signIn: ', userRes);\n                    const userInfo = userRes[0].user;\n                    // Store user ID for session\n                    user.id = userInfo._id;\n                    user.authProvider = 'google';\n                    user.name = userInfo.name;\n                    user.email = userInfo.email;\n                    user.token = userRes[0].token;\n                    user.userInfo = userInfo;\n                    return true;\n                }\n                return false;\n            }\n            return true;\n        },\n        async jwt({ token, user }) {\n            // Attach JWT from Express or Google access token\n            if (user) {\n                token.user = user?.userInfo;\n                token.jwt = user?.token || token.jwt;\n            }\n            return token;\n        },\n        async session({ session, token }) {\n            const user = token.user as Record<string, unknown>;\n            (session as Session).user = user;\n            (session as Session).jwt = token.jwt as string | undefined;\n            (session as Session).permissions = [];\n            const { userGroup } = user as any;\n            if (userGroup) {\n                const permissions = userGroup?.permissions as any;\n                if (permissions) {\n                    for (const permission of permissions) {\n                        const moduleName = permission?.module?.name;\n                        if (moduleName) {\n                            permission?.actions?.forEach((action: any) => {\n                                (session as Session).permissions.push(\n                                    `${moduleName.toLowerCase()}.${action?.toLowerCase()}`\n                                );\n                            });\n                        }\n                    }\n                }\n            }\n            return session;\n        },\n        authorized({ auth, request: { nextUrl } }) {\n            const isLoggedIn = !!auth?.user;\n            const isLoginPage = nextUrl.pathname === '/login';\n\n            // 1. Not logged in → redirect to /login (unless already on /login)\n            if (!isLoggedIn && !isLoginPage) {\n                return Response.redirect(new URL('/login', nextUrl));\n            }\n\n            // 2. Logged in and trying to visit /login → redirect based on role\n            if (isLoggedIn && isLoginPage) {\n                const userRole = auth.user?.role;\n                if (userRole === 'admin') {\n                    return Response.redirect(\n                        new URL('/admin/dashboard', nextUrl)\n                    );\n                } else {\n                    return Response.redirect(new URL('/', nextUrl));\n                }\n            }\n\n            if (nextUrl.pathname === '/') {\n                const userRole = auth?.user?.role;\n                if (userRole === 'admin') {\n                    return Response.redirect(\n                        new URL('/admin/dashboard', nextUrl)\n                    );\n                } else {\n                    return Response.redirect(new URL('/', nextUrl));\n                }\n            }\n\n            // 3. All other cases: allow\n            return true;\n        },\n    },\n    providers: [], // Add providers with an empty array for now\n} satisfies NextAuthConfig;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/auth.ts"],"sourcesContent":["import NextAuth, { User } from 'next-auth';\nimport { authConfig } from './auth.config';\nimport Credentials from 'next-auth/providers/credentials';\nimport GoogleProvider from 'next-auth/providers/google';\nimport { z } from 'zod';\nimport axiosClient from './axiosClient';\nimport { ILoginResponse, IUser } from './types';\n\nasync function authenticate(email: string, password: string) {\n    try {\n        const res = await axiosClient.post('/auth/login', { email, password });\n        return res.data;\n    } catch (error: any) {\n        // console.log('\\n\\n\\nauthenticate error:', error);\n        if ('errorData' in error) {\n            console.log('\\n\\n\\nauthenticate error:', error.errorData);\n\n            // Try different error message paths\n            let message = 'Failed to authenticate user.';\n\n            if (error.errorData?.error?.messages?.[0]) {\n                message = error.errorData.error.messages[0];\n            } else if (error.errorData?.messages?.[0]) {\n                message = error.errorData.messages[0];\n            } else if (error.errorData?.message) {\n                message = error.errorData.message;\n            } else if (error.message) {\n                message = error.message;\n            }\n\n            throw new Error(message);\n        }\n        throw new Error('Failed to authenticate user.');\n    }\n}\n\nexport const { auth, signIn, signOut, handlers } = NextAuth({\n    ...authConfig,\n    providers: [\n        Credentials({\n            name: 'Credentials',\n            credentials: {\n                email: { label: 'Email', type: 'text' },\n                password: { label: 'Password', type: 'password' },\n            },\n            authorize: async (credentials) => {\n                const parsedCredentials = z\n                    .object({\n                        email: z.string().email(),\n                        password: z.string().min(6),\n                    })\n                    .safeParse(credentials);\n\n                if (parsedCredentials.success) {\n                    const { email, password } = parsedCredentials.data;\n                    const user: ILoginResponse = await authenticate(\n                        email,\n                        password\n                    );\n                    // console.log('\\n\\n\\n=============>user:', user);\n                    if (!user) return null;\n\n                    if (user.status === 'success') {\n                        const userInfo = user.data[0].user;\n                        return {\n                            id: userInfo._id,\n                            name: userInfo.name,\n                            email: userInfo.email,\n                            token: user.data[0].token,\n                            userInfo,\n                        } as User & { userInfo: IUser };\n                    }\n                }\n                return null;\n            },\n        }),\n\n        GoogleProvider({\n            clientId: process.env.GOOGLE_CLIENT_ID!,\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n        }),\n    ],\n});\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;;;;;;;AAGA,eAAe,aAAa,KAAa,EAAE,QAAgB;IACvD,IAAI;QACA,MAAM,MAAM,MAAM,0HAAA,CAAA,UAAW,CAAC,IAAI,CAAC,eAAe;YAAE;YAAO;QAAS;QACpE,OAAO,IAAI,IAAI;IACnB,EAAE,OAAO,OAAY;QACjB,mDAAmD;QACnD,IAAI,eAAe,OAAO;YACtB,QAAQ,GAAG,CAAC,6BAA6B,MAAM,SAAS;YAExD,oCAAoC;YACpC,IAAI,UAAU;YAEd,IAAI,MAAM,SAAS,EAAE,OAAO,UAAU,CAAC,EAAE,EAAE;gBACvC,UAAU,MAAM,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,EAAE;YAC/C,OAAO,IAAI,MAAM,SAAS,EAAE,UAAU,CAAC,EAAE,EAAE;gBACvC,UAAU,MAAM,SAAS,CAAC,QAAQ,CAAC,EAAE;YACzC,OAAO,IAAI,MAAM,SAAS,EAAE,SAAS;gBACjC,UAAU,MAAM,SAAS,CAAC,OAAO;YACrC,OAAO,IAAI,MAAM,OAAO,EAAE;gBACtB,UAAU,MAAM,OAAO;YAC3B;YAEA,MAAM,IAAI,MAAM;QACpB;QACA,MAAM,IAAI,MAAM;IACpB;AACJ;AAEO,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,CAAA,GAAA,gWAAA,CAAA,UAAQ,AAAD,EAAE;IACxD,GAAG,6HAAA,CAAA,aAAU;IACb,WAAW;QACP,CAAA,GAAA,8NAAA,CAAA,UAAW,AAAD,EAAE;YACR,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,WAAW,OAAO;gBACd,MAAM,oBAAoB,yNAAA,CAAA,IAAC,CACtB,MAAM,CAAC;oBACJ,OAAO,yNAAA,CAAA,IAAC,CAAC,MAAM,GAAG,KAAK;oBACvB,UAAU,yNAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC;gBAC7B,GACC,SAAS,CAAC;gBAEf,IAAI,kBAAkB,OAAO,EAAE;oBAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,kBAAkB,IAAI;oBAClD,MAAM,OAAuB,MAAM,aAC/B,OACA;oBAEJ,kDAAkD;oBAClD,IAAI,CAAC,MAAM,OAAO;oBAElB,IAAI,KAAK,MAAM,KAAK,WAAW;wBAC3B,MAAM,WAAW,KAAK,IAAI,CAAC,EAAE,CAAC,IAAI;wBAClC,OAAO;4BACH,IAAI,SAAS,GAAG;4BAChB,MAAM,SAAS,IAAI;4BACnB,OAAO,SAAS,KAAK;4BACrB,OAAO,KAAK,IAAI,CAAC,EAAE,CAAC,KAAK;4BACzB;wBACJ;oBACJ;gBACJ;gBACA,OAAO;YACX;QACJ;QAEA,CAAA,GAAA,yNAAA,CAAA,UAAc,AAAD,EAAE;YACX,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAClD;KACH;AACL"}},
    {"offset": {"line": 343, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { auth } from '@/auth';\nimport { NextRequest, NextResponse } from 'next/server';\n\n// Define permissions map for different routes\nconst PERMISSIONS_MAP: { [key: string]: string[] } = {\n    '/users': ['users.view'],\n    '/users/add': ['users.create', 'user-groups.view'],\n    '/users/[userId]': ['users.view', 'users.edit', 'user-groups.view'],\n    '/projects': ['projects.view'],\n    '/projects/add': ['projects.create'],\n    '/projects/[id]': ['projects.view'],\n    '/projects/[id]/calls': ['projects.view', 'calls.view'],\n    '/projects/[id]/calls/add': ['projects.view', 'calls.create'],\n    '/projects/[id]/calls/[callId]': ['projects.view', 'calls.view'],\n    '/projects/[id]/calls/[callId]/edit': ['projects.view', 'calls.edit'],\n    '/projects/[id]/calls/[callId]/start-call': ['projects.view', 'calls.view'],\n    '/projects/[id]/users': [\n        'projects.view',\n        'users.view',\n        'projects.users.view',\n    ],\n    '/user-groups': ['user-groups.view'],\n    '/user-groups/add': ['user-groups.create'],\n    '/user-groups/[userGroupId]': ['user-groups.view', 'user-groups.edit'],\n    // '/dashboard': ['dashboard.view'], // Commented out as requested\n};\n\n// Helper function to check if user has required permissions\nfunction hasPermission(\n    userPermissions: string[],\n    requiredPermissions: string[]\n): boolean {\n    return requiredPermissions.every((permission) =>\n        userPermissions.includes(permission)\n    );\n}\n\n// Helper function to match route pattern\nfunction matchRoute(pathname: string, routePattern: string): boolean {\n    // Convert Next.js dynamic route pattern to regex\n    const regexPattern = routePattern\n        .replace(/\\[([^\\]]+)\\]/g, '[^/]+') // Replace [param] with regex\n        .replace(/\\//g, '\\\\/'); // Escape forward slashes\n\n    const regex = new RegExp(`^${regexPattern}$`);\n    return regex.test(pathname);\n}\n\n// Helper function to find required permissions for a pathname\nfunction getRequiredPermissions(pathname: string): string[] {\n    for (const [routePattern, permissions] of Object.entries(PERMISSIONS_MAP)) {\n        if (matchRoute(pathname, routePattern)) {\n            return permissions;\n        }\n    }\n    return [];\n}\n\nexport async function middleware(req: NextRequest) {\n    const pathname = req.nextUrl.pathname;\n\n    // Skip permission check for public routes\n    const publicRoutes = ['/login', '/api', '/_next', '/favicon.ico', '/'];\n    const isPublicRoute = publicRoutes.some((route) =>\n        pathname.startsWith(route)\n    );\n\n    if (isPublicRoute) {\n        return NextResponse.next();\n    }\n\n    // Get the session using NextAuth v5 auth function\n    const session = await auth();\n    console.log('\\n\\n\\n=============>session:', session);\n\n    // If no session, redirect to login\n    if (!session) {\n        return NextResponse.redirect(new URL('/login', req.url));\n    }\n\n    // Check if user is admin - admins have access to everything\n    const userRole = session.user?.role;\n    if (userRole === 'admin') {\n        console.log(\n            `Admin access granted: ${pathname} - Admin role bypasses permission checks`\n        );\n        return NextResponse.next();\n    }\n\n    const userPermissions = session.permissions || [];\n\n    // Get required permissions for the current route\n    const requiredPermissions = getRequiredPermissions(pathname);\n\n    // If no specific permissions are required, allow access\n    if (requiredPermissions.length === 0) {\n        return NextResponse.next();\n    }\n\n    // Check if user has required permissions\n    if (!hasPermission(userPermissions, requiredPermissions)) {\n        console.log(\n            `Access denied: ${pathname} requires ${requiredPermissions.join(\n                ', '\n            )} but user has ${userPermissions.join(', ')}`\n        );\n        return NextResponse.redirect(new URL('/403', req.url));\n    }\n\n    console.log(\n        `Access granted: ${pathname} - User has required permissions: ${requiredPermissions.join(\n            ', '\n        )}`\n    );\n    return NextResponse.next();\n}\n\nexport const config = {\n    matcher: [\n        /*\n         * Match all request paths except for the ones starting with:\n         * - api (API routes)\n         * - _next/static (static files)\n         * - _next/image (image optimization files)\n         * - favicon.ico (favicon file)\n         * - public files (images, etc.)\n         */\n        '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n    ],\n};\n"],"names":[],"mappings":"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"}}]
}